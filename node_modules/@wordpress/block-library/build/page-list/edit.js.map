{"version":3,"sources":["@wordpress/block-library/src/page-list/edit.js"],"names":["MAX_PAGE_COUNT","NOOP","PageListEdit","context","clientId","attributes","setAttributes","parentPageID","pages","useGetPages","pagesByParentId","totalPages","hasResolvedPages","usePageData","isNavigationChild","allowConvertToLinks","isOpen","setOpen","openModal","closeModal","blockProps","className","textColor","backgroundColor","style","color","getBlockList","parentId","childPages","get","length","reduce","template","page","hasChildren","has","id","pageProps","label","title","rendered","link","url","item","children","push","makePagesTree","level","tree","value","repeat","rawName","pagesTree","blockList","innerBlocksProps","allowedBlocks","renderAppender","__unstableDisableDropZone","templateLock","onInput","onChange","getBlockContent","parentPageDetails","find","replaceBlock","selectBlock","blockEditorStore","parentNavBlockClientId","isNested","select","getSelectedBlockClientId","getBlockParentsByBlockName","_selectedBlockClientId","convertDescription","navigationLinks","records","hasResolved","orderby","order","_fields","per_page","pageId","sortedPages","sort","a","b","menu_order","localeCompare","accumulator","parent","set","Map"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { createBlock } from '@wordpress/blocks';\nimport {\n\tInspectorControls,\n\tBlockControls,\n\tuseBlockProps,\n\tuseInnerBlocksProps,\n\tgetColorClassName,\n\tstore as blockEditorStore,\n\tWarning,\n} from '@wordpress/block-editor';\nimport {\n\tPanelBody,\n\tToolbarButton,\n\tSpinner,\n\tNotice,\n\tComboboxControl,\n\tButton,\n} from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { useMemo, useState, useEffect } from '@wordpress/element';\nimport { useEntityRecords } from '@wordpress/core-data';\nimport { useSelect, useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport ConvertToLinksModal from './convert-to-links-modal';\nimport { convertToNavigationLinks } from './convert-to-navigation-links';\nimport { convertDescription } from './constants';\n\n// We only show the edit option when page count is <= MAX_PAGE_COUNT\n// Performance of Navigation Links is not good past this value.\nconst MAX_PAGE_COUNT = 100;\nconst NOOP = () => {};\n\nexport default function PageListEdit( {\n\tcontext,\n\tclientId,\n\tattributes,\n\tsetAttributes,\n} ) {\n\tconst { parentPageID } = attributes;\n\tconst [ pages ] = useGetPages();\n\tconst { pagesByParentId, totalPages, hasResolvedPages } = usePageData();\n\n\tconst isNavigationChild = 'showSubmenuIcon' in context;\n\tconst allowConvertToLinks =\n\t\tisNavigationChild && totalPages <= MAX_PAGE_COUNT;\n\n\tconst [ isOpen, setOpen ] = useState( false );\n\tconst openModal = () => setOpen( true );\n\tconst closeModal = () => setOpen( false );\n\n\tconst blockProps = useBlockProps( {\n\t\tclassName: classnames( 'wp-block-page-list', {\n\t\t\t'has-text-color': !! context.textColor,\n\t\t\t[ getColorClassName( 'color', context.textColor ) ]:\n\t\t\t\t!! context.textColor,\n\t\t\t'has-background': !! context.backgroundColor,\n\t\t\t[ getColorClassName(\n\t\t\t\t'background-color',\n\t\t\t\tcontext.backgroundColor\n\t\t\t) ]: !! context.backgroundColor,\n\t\t} ),\n\t\tstyle: { ...context.style?.color },\n\t} );\n\n\tconst getBlockList = ( parentId = parentPageID ) => {\n\t\tconst childPages = pagesByParentId.get( parentId );\n\n\t\tif ( ! childPages?.length ) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn childPages.reduce( ( template, page ) => {\n\t\t\tconst hasChildren = pagesByParentId.has( page.id );\n\t\t\tconst pageProps = {\n\t\t\t\tid: page.id,\n\t\t\t\tlabel: page.title?.rendered,\n\t\t\t\ttitle: page.title?.rendered,\n\t\t\t\tlink: page.url,\n\t\t\t\thasChildren,\n\t\t\t};\n\t\t\tlet item = null;\n\t\t\tconst children = getBlockList( page.id );\n\t\t\titem = createBlock( 'core/page-list-item', pageProps, children );\n\t\t\ttemplate.push( item );\n\n\t\t\treturn template;\n\t\t}, [] );\n\t};\n\n\tconst makePagesTree = ( parentId = 0, level = 0 ) => {\n\t\tconst childPages = pagesByParentId.get( parentId );\n\n\t\tif ( ! childPages?.length ) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn childPages.reduce( ( tree, page ) => {\n\t\t\tconst hasChildren = pagesByParentId.has( page.id );\n\t\t\tconst item = {\n\t\t\t\tvalue: page.id,\n\t\t\t\tlabel: 'â€” '.repeat( level ) + page.title.rendered,\n\t\t\t\trawName: page.title.rendered,\n\t\t\t};\n\t\t\ttree.push( item );\n\t\t\tif ( hasChildren ) {\n\t\t\t\ttree.push( ...makePagesTree( page.id, level + 1 ) );\n\t\t\t}\n\t\t\treturn tree;\n\t\t}, [] );\n\t};\n\n\tconst pagesTree = useMemo( makePagesTree, [ pagesByParentId ] );\n\n\tconst blockList = useMemo( getBlockList, [\n\t\tpagesByParentId,\n\t\tparentPageID,\n\t] );\n\n\tconst innerBlocksProps = useInnerBlocksProps( blockProps, {\n\t\tallowedBlocks: [ 'core/page-list-item' ],\n\t\trenderAppender: false,\n\t\t__unstableDisableDropZone: true,\n\t\ttemplateLock: 'all',\n\t\tonInput: NOOP,\n\t\tonChange: NOOP,\n\t\tvalue: blockList,\n\t} );\n\n\tconst getBlockContent = () => {\n\t\tif ( ! hasResolvedPages ) {\n\t\t\treturn (\n\t\t\t\t<div { ...blockProps }>\n\t\t\t\t\t<Spinner />\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tif ( totalPages === null ) {\n\t\t\treturn (\n\t\t\t\t<div { ...blockProps }>\n\t\t\t\t\t<Notice status={ 'warning' } isDismissible={ false }>\n\t\t\t\t\t\t{ __( 'Page List: Cannot retrieve Pages.' ) }\n\t\t\t\t\t</Notice>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tif ( totalPages === 0 ) {\n\t\t\treturn (\n\t\t\t\t<div { ...blockProps }>\n\t\t\t\t\t<Notice status={ 'info' } isDismissible={ false }>\n\t\t\t\t\t\t{ __( 'Page List: Cannot retrieve Pages.' ) }\n\t\t\t\t\t</Notice>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tif ( blockList.length === 0 ) {\n\t\t\tconst parentPageDetails =\n\t\t\t\tpages && pages.find( ( page ) => page.id === parentPageID );\n\t\t\treturn (\n\t\t\t\t<div { ...blockProps }>\n\t\t\t\t\t<Warning>\n\t\t\t\t\t\t{ sprintf(\n\t\t\t\t\t\t\t// translators: %s: Page title.\n\t\t\t\t\t\t\t__( '\"%s\" page has no children.' ),\n\t\t\t\t\t\t\tparentPageDetails.title.rendered\n\t\t\t\t\t\t) }\n\t\t\t\t\t</Warning>\n\t\t\t\t</div>\n\t\t\t);\n\t\t}\n\n\t\tif ( totalPages > 0 ) {\n\t\t\treturn <ul { ...innerBlocksProps }></ul>;\n\t\t}\n\t};\n\n\tconst { replaceBlock, selectBlock } = useDispatch( blockEditorStore );\n\n\tconst { parentNavBlockClientId, isNested } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getSelectedBlockClientId, getBlockParentsByBlockName } =\n\t\t\t\tselect( blockEditorStore );\n\n\t\t\tconst _selectedBlockClientId = getSelectedBlockClientId();\n\n\t\t\treturn {\n\t\t\t\tparentNavBlockClientId: getBlockParentsByBlockName(\n\t\t\t\t\t_selectedBlockClientId,\n\t\t\t\t\t'core/navigation',\n\t\t\t\t\ttrue\n\t\t\t\t)[ 0 ],\n\t\t\t\tisNested:\n\t\t\t\t\tgetBlockParentsByBlockName(\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\t'core/navigation-submenu',\n\t\t\t\t\t\ttrue\n\t\t\t\t\t).length > 0,\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\n\tuseEffect( () => {\n\t\tsetAttributes( { isNested } );\n\t}, [ isNested ] );\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls>\n\t\t\t\t{ isNavigationChild && pages?.length > 0 && (\n\t\t\t\t\t<PanelBody title={ __( 'Customize this menu' ) }>\n\t\t\t\t\t\t<p>{ convertDescription }</p>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t\t\t\tdisabled={ ! hasResolvedPages }\n\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\tconst navigationLinks =\n\t\t\t\t\t\t\t\t\tconvertToNavigationLinks( pages );\n\n\t\t\t\t\t\t\t\t// Replace the Page List block with the Navigation Links.\n\t\t\t\t\t\t\t\treplaceBlock( clientId, navigationLinks );\n\n\t\t\t\t\t\t\t\t// Select the Navigation block to reveal the changes.\n\t\t\t\t\t\t\t\tselectBlock( parentNavBlockClientId );\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ __( 'Customize' ) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t) }\n\t\t\t\t{ pagesTree.length > 0 && (\n\t\t\t\t\t<PanelBody>\n\t\t\t\t\t\t<ComboboxControl\n\t\t\t\t\t\t\tclassName=\"editor-page-attributes__parent\"\n\t\t\t\t\t\t\tlabel={ __( 'Parent page' ) }\n\t\t\t\t\t\t\tvalue={ parentPageID }\n\t\t\t\t\t\t\toptions={ pagesTree }\n\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\tsetAttributes( { parentPageID: value ?? 0 } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\thelp={ __(\n\t\t\t\t\t\t\t\t'Choose a page to show only its subpages.'\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t) }\n\t\t\t</InspectorControls>\n\t\t\t{ allowConvertToLinks && totalPages > 0 && (\n\t\t\t\t<BlockControls group=\"other\">\n\t\t\t\t\t<ToolbarButton title={ __( 'Edit' ) } onClick={ openModal }>\n\t\t\t\t\t\t{ __( 'Edit' ) }\n\t\t\t\t\t</ToolbarButton>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t{ allowConvertToLinks && isOpen && (\n\t\t\t\t<ConvertToLinksModal\n\t\t\t\t\tonClose={ closeModal }\n\t\t\t\t\tclientId={ clientId }\n\t\t\t\t/>\n\t\t\t) }\n\n\t\t\t{ getBlockContent() }\n\t\t</>\n\t);\n}\n\nfunction useGetPages() {\n\tconst { records: pages, hasResolved: hasResolvedPages } = useEntityRecords(\n\t\t'postType',\n\t\t'page',\n\t\t{\n\t\t\torderby: 'menu_order',\n\t\t\torder: 'asc',\n\t\t\t_fields: [ 'id', 'link', 'parent', 'title', 'menu_order' ],\n\t\t\tper_page: -1,\n\t\t\tcontext: 'view',\n\t\t}\n\t);\n\n\treturn [ pages, hasResolvedPages ];\n}\n\nfunction usePageData( pageId = 0 ) {\n\tconst [ pages, hasResolvedPages ] = useGetPages();\n\n\treturn useMemo( () => {\n\t\t// TODO: Once the REST API supports passing multiple values to\n\t\t// 'orderby', this can be removed.\n\t\t// https://core.trac.wordpress.org/ticket/39037\n\n\t\tconst sortedPages = [ ...( pages ?? [] ) ].sort( ( a, b ) => {\n\t\t\tif ( a.menu_order === b.menu_order ) {\n\t\t\t\treturn a.title.rendered.localeCompare( b.title.rendered );\n\t\t\t}\n\t\t\treturn a.menu_order - b.menu_order;\n\t\t} );\n\t\tconst pagesByParentId = sortedPages.reduce( ( accumulator, page ) => {\n\t\t\tconst { parent } = page;\n\t\t\tif ( accumulator.has( parent ) ) {\n\t\t\t\taccumulator.get( parent ).push( page );\n\t\t\t} else {\n\t\t\t\taccumulator.set( parent, [ page ] );\n\t\t\t}\n\t\t\treturn accumulator;\n\t\t}, new Map() );\n\n\t\treturn {\n\t\t\tpagesByParentId,\n\t\t\thasResolvedPages,\n\t\t\ttotalPages: pages?.length ?? null,\n\t\t};\n\t}, [ pageId, pages, hasResolvedPages ] );\n}\n"]}