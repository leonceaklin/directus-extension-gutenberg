{"version":3,"sources":["@wordpress/editor/src/components/provider/index.native.js"],"names":["memize","SafeAreaProvider","RNReactNativeGutenbergBridge","requestBlockTypeImpressions","setBlockTypeImpressions","subscribeParentGetHtml","subscribeParentToggleHTMLMode","subscribeUpdateHtml","subscribeSetTitle","subscribeMediaAppend","subscribeReplaceBlock","subscribeUpdateEditorSettings","subscribeUpdateCapabilities","subscribeShowNotice","subscribeShowEditorHelp","Component","count","wordCount","parse","serialize","getUnregisteredTypeHandlerName","createBlock","withDispatch","withSelect","compose","applyFilters","store","blockEditorStore","getGlobalStyles","getColorsAndGradients","NEW_BLOCK_TYPES","postTypeEntities","name","baseURL","map","postTypeEntity","kind","transientEdits","blocks","selection","mergedEdits","meta","rawAttributes","EditorHelpTopics","editorStore","noticesStore","coreStore","editPostStore","EditorProvider","NativeEditorProvider","constructor","arguments","post","props","addEntities","receiveEntityRecords","type","getEditorSettings","settings","capabilities","maxSize","state","isHelpVisible","componentDidMount","locale","hostAppNamespace","updateSettings","getThemeColors","subscriptionParentGetHtml","serializeToNativeAction","subscriptionParentToggleHTMLMode","toggleMode","subscriptionParentSetTitle","payload","editTitle","title","subscriptionParentUpdateHtml","updateHtmlAction","html","subscriptionParentReplaceBlock","replaceBlockAction","clientId","subscriptionParentMediaAppend","blockName","mediaType","newBlock","id","mediaId","mediaUrl","indexAfterSelected","selectedBlockIndex","insertionIndex","blockCount","insertBlock","subscriptionParentUpdateEditorSettings","galleryWithImageBlocks","editorSettings","window","wp","galleryBlockV2Enabled","subscriptionParentUpdateCapabilities","updateCapabilitiesAction","subscriptionParentShowNotice","createSuccessNotice","message","subscriptionParentShowEditorHelp","setState","storedImpressions","impressions","storedImpressionKeys","Object","keys","storedImpressionsCurrent","every","newKey","includes","componentWillUnmount","remove","rawStyles","rawFeatures","defaultEditorColors","defaultEditorGradients","componentDidUpdate","prevProps","isReady","isUnsupportedBlock","unsupportedBlockNames","filter","block","attributes","originalName","editorDidMount","mode","hasChanges","raw","content","contentInfo","characterCount","paragraphCount","provideToNative_Html","parsed","resetEditorBlocksWithoutUndoLevel","blockClientId","replaceBlock","switchMode","clearSelectedBlock","render","children","supportSection","select","__unstableIsEditorReady","isEditorReady","getEditorBlocks","getEditedPostAttribute","getEditedPostContent","getEditorMode","getBlockIndex","getSelectedBlockClientId","getGlobalBlockCount","getSettings","getBlockEditorSettings","colors","gradients","selectedBlockClientId","dispatch","editPost","resetEditorBlocks","switchEditorMode","__unstableShouldCreateUndoLevel"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport memize from 'memize';\nimport { SafeAreaProvider } from 'react-native-safe-area-context';\n\n/**\n * WordPress dependencies\n */\nimport RNReactNativeGutenbergBridge, {\n\trequestBlockTypeImpressions,\n\tsetBlockTypeImpressions,\n\tsubscribeParentGetHtml,\n\tsubscribeParentToggleHTMLMode,\n\tsubscribeUpdateHtml,\n\tsubscribeSetTitle,\n\tsubscribeMediaAppend,\n\tsubscribeReplaceBlock,\n\tsubscribeUpdateEditorSettings,\n\tsubscribeUpdateCapabilities,\n\tsubscribeShowNotice,\n\tsubscribeShowEditorHelp,\n} from '@wordpress/react-native-bridge';\nimport { Component } from '@wordpress/element';\nimport { count as wordCount } from '@wordpress/wordcount';\nimport {\n\tparse,\n\tserialize,\n\tgetUnregisteredTypeHandlerName,\n\tcreateBlock,\n} from '@wordpress/blocks';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { applyFilters } from '@wordpress/hooks';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport { getGlobalStyles, getColorsAndGradients } from '@wordpress/components';\nimport { NEW_BLOCK_TYPES } from '@wordpress/block-library';\n\nconst postTypeEntities = [\n\t{ name: 'post', baseURL: '/wp/v2/posts' },\n\t{ name: 'page', baseURL: '/wp/v2/pages' },\n\t{ name: 'attachment', baseURL: '/wp/v2/media' },\n\t{ name: 'wp_block', baseURL: '/wp/v2/blocks' },\n].map( ( postTypeEntity ) => ( {\n\tkind: 'postType',\n\t...postTypeEntity,\n\ttransientEdits: {\n\t\tblocks: true,\n\t\tselection: true,\n\t},\n\tmergedEdits: {\n\t\tmeta: true,\n\t},\n\trawAttributes: [ 'title', 'excerpt', 'content' ],\n} ) );\nimport { EditorHelpTopics, store as editorStore } from '@wordpress/editor';\nimport { store as noticesStore } from '@wordpress/notices';\nimport { store as coreStore } from '@wordpress/core-data';\n// eslint-disable-next-line no-restricted-imports\nimport { store as editPostStore } from '@wordpress/edit-post';\n\n/**\n * Internal dependencies\n */\nimport EditorProvider from './index.js';\n\nclass NativeEditorProvider extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\t// Keep a local reference to `post` to detect changes.\n\t\tthis.post = this.props.post;\n\t\tthis.props.addEntities( postTypeEntities );\n\t\tthis.props.receiveEntityRecords(\n\t\t\t'postType',\n\t\t\tthis.post.type,\n\t\t\tthis.post\n\t\t);\n\n\t\tthis.getEditorSettings = memize(\n\t\t\t( settings, capabilities ) => ( {\n\t\t\t\t...settings,\n\t\t\t\tcapabilities,\n\t\t\t} ),\n\t\t\t{\n\t\t\t\tmaxSize: 1,\n\t\t\t}\n\t\t);\n\t\tthis.state = {\n\t\t\tisHelpVisible: false,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { capabilities, locale, hostAppNamespace, updateSettings } =\n\t\t\tthis.props;\n\n\t\tupdateSettings( {\n\t\t\t...capabilities,\n\t\t\t...this.getThemeColors( this.props ),\n\t\t\tlocale,\n\t\t\thostAppNamespace,\n\t\t} );\n\n\t\tthis.subscriptionParentGetHtml = subscribeParentGetHtml( () => {\n\t\t\tthis.serializeToNativeAction();\n\t\t} );\n\n\t\tthis.subscriptionParentToggleHTMLMode = subscribeParentToggleHTMLMode(\n\t\t\t() => {\n\t\t\t\tthis.toggleMode();\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentSetTitle = subscribeSetTitle( ( payload ) => {\n\t\t\tthis.props.editTitle( payload.title );\n\t\t} );\n\n\t\tthis.subscriptionParentUpdateHtml = subscribeUpdateHtml(\n\t\t\t( payload ) => {\n\t\t\t\tthis.updateHtmlAction( payload.html );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentReplaceBlock = subscribeReplaceBlock(\n\t\t\t( payload ) => {\n\t\t\t\tthis.replaceBlockAction( payload.html, payload.clientId );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentMediaAppend = subscribeMediaAppend(\n\t\t\t( payload ) => {\n\t\t\t\tconst blockName = 'core/' + payload.mediaType;\n\t\t\t\tconst newBlock = createBlock( blockName, {\n\t\t\t\t\tid: payload.mediaId,\n\t\t\t\t\t[ payload.mediaType === 'image' ? 'url' : 'src' ]:\n\t\t\t\t\t\tpayload.mediaUrl,\n\t\t\t\t} );\n\n\t\t\t\tconst indexAfterSelected = this.props.selectedBlockIndex + 1;\n\t\t\t\tconst insertionIndex =\n\t\t\t\t\tindexAfterSelected || this.props.blockCount;\n\n\t\t\t\tthis.props.insertBlock( newBlock, insertionIndex );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentUpdateEditorSettings =\n\t\t\tsubscribeUpdateEditorSettings(\n\t\t\t\t( { galleryWithImageBlocks, ...editorSettings } ) => {\n\t\t\t\t\tif ( typeof galleryWithImageBlocks === 'boolean' ) {\n\t\t\t\t\t\twindow.wp.galleryBlockV2Enabled =\n\t\t\t\t\t\t\tgalleryWithImageBlocks;\n\t\t\t\t\t}\n\t\t\t\t\tupdateSettings( this.getThemeColors( editorSettings ) );\n\t\t\t\t}\n\t\t\t);\n\n\t\tthis.subscriptionParentUpdateCapabilities = subscribeUpdateCapabilities(\n\t\t\t( payload ) => {\n\t\t\t\tthis.updateCapabilitiesAction( payload );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentShowNotice = subscribeShowNotice(\n\t\t\t( payload ) => {\n\t\t\t\tthis.props.createSuccessNotice( payload.message );\n\t\t\t}\n\t\t);\n\n\t\tthis.subscriptionParentShowEditorHelp = subscribeShowEditorHelp( () => {\n\t\t\tthis.setState( { isHelpVisible: true } );\n\t\t} );\n\n\t\t// Request current block impressions from native app.\n\t\trequestBlockTypeImpressions( ( storedImpressions ) => {\n\t\t\tconst impressions = { ...NEW_BLOCK_TYPES, ...storedImpressions };\n\n\t\t\t// Persist impressions to JavaScript store.\n\t\t\tupdateSettings( { impressions } );\n\n\t\t\t// Persist impressions to native store if they do not include latest\n\t\t\t// `NEW_BLOCK_TYPES` configuration.\n\t\t\tconst storedImpressionKeys = Object.keys( storedImpressions );\n\t\t\tconst storedImpressionsCurrent = Object.keys(\n\t\t\t\tNEW_BLOCK_TYPES\n\t\t\t).every( ( newKey ) => storedImpressionKeys.includes( newKey ) );\n\t\t\tif ( ! storedImpressionsCurrent ) {\n\t\t\t\tsetBlockTypeImpressions( impressions );\n\t\t\t}\n\t\t} );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this.subscriptionParentGetHtml ) {\n\t\t\tthis.subscriptionParentGetHtml.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentToggleHTMLMode ) {\n\t\t\tthis.subscriptionParentToggleHTMLMode.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentSetTitle ) {\n\t\t\tthis.subscriptionParentSetTitle.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentUpdateHtml ) {\n\t\t\tthis.subscriptionParentUpdateHtml.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentReplaceBlock ) {\n\t\t\tthis.subscriptionParentReplaceBlock.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentMediaAppend ) {\n\t\t\tthis.subscriptionParentMediaAppend.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentUpdateEditorSettings ) {\n\t\t\tthis.subscriptionParentUpdateEditorSettings.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentUpdateCapabilities ) {\n\t\t\tthis.subscriptionParentUpdateCapabilities.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentShowNotice ) {\n\t\t\tthis.subscriptionParentShowNotice.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentShowEditorHelp ) {\n\t\t\tthis.subscriptionParentShowEditorHelp.remove();\n\t\t}\n\t}\n\n\tgetThemeColors( { rawStyles, rawFeatures } ) {\n\t\tconst { defaultEditorColors, defaultEditorGradients } = this.props;\n\n\t\tif ( rawStyles && rawFeatures ) {\n\t\t\treturn getGlobalStyles( rawStyles, rawFeatures );\n\t\t}\n\n\t\treturn getColorsAndGradients(\n\t\t\tdefaultEditorColors,\n\t\t\tdefaultEditorGradients,\n\t\t\trawFeatures\n\t\t);\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( ! prevProps.isReady && this.props.isReady ) {\n\t\t\tconst blocks = this.props.blocks;\n\t\t\tconst isUnsupportedBlock = ( { name } ) =>\n\t\t\t\tname === getUnregisteredTypeHandlerName();\n\t\t\tconst unsupportedBlockNames = blocks\n\t\t\t\t.filter( isUnsupportedBlock )\n\t\t\t\t.map( ( block ) => block.attributes.originalName );\n\t\t\tRNReactNativeGutenbergBridge.editorDidMount(\n\t\t\t\tunsupportedBlockNames\n\t\t\t);\n\t\t}\n\t}\n\n\tserializeToNativeAction() {\n\t\tconst title = this.props.title;\n\t\tlet html;\n\n\t\tif ( this.props.mode === 'text' ) {\n\t\t\t// The HTMLTextInput component does not update the store when user is doing changes\n\t\t\t// Let's request the HTML from the component's state directly.\n\t\t\thtml = applyFilters( 'native.persist-html' );\n\t\t} else {\n\t\t\thtml = serialize( this.props.blocks );\n\t\t}\n\n\t\tconst hasChanges =\n\t\t\ttitle !== this.post.title.raw || html !== this.post.content.raw;\n\n\t\t// Variable to store the content structure metrics.\n\t\tconst contentInfo = {};\n\t\tcontentInfo.characterCount = wordCount(\n\t\t\thtml,\n\t\t\t'characters_including_spaces'\n\t\t);\n\t\tcontentInfo.wordCount = wordCount( html, 'words' );\n\t\tcontentInfo.paragraphCount = this.props.paragraphCount;\n\t\tcontentInfo.blockCount = this.props.blockCount;\n\t\tRNReactNativeGutenbergBridge.provideToNative_Html(\n\t\t\thtml,\n\t\t\ttitle,\n\t\t\thasChanges,\n\t\t\tcontentInfo\n\t\t);\n\n\t\tif ( hasChanges ) {\n\t\t\tthis.post.title.raw = title;\n\t\t\tthis.post.content.raw = html;\n\t\t}\n\t}\n\n\tupdateHtmlAction( html ) {\n\t\tconst parsed = parse( html );\n\t\tthis.props.resetEditorBlocksWithoutUndoLevel( parsed );\n\t}\n\n\treplaceBlockAction( html, blockClientId ) {\n\t\tconst parsed = parse( html );\n\t\tthis.props.replaceBlock( blockClientId, parsed );\n\t}\n\n\ttoggleMode() {\n\t\tconst { mode, switchMode } = this.props;\n\t\t// Refresh html content first.\n\t\tthis.serializeToNativeAction();\n\t\t// Make sure to blur the selected block and dismiss the keyboard.\n\t\tthis.props.clearSelectedBlock();\n\t\tswitchMode( mode === 'visual' ? 'text' : 'visual' );\n\t}\n\n\tupdateCapabilitiesAction( capabilities ) {\n\t\tthis.props.updateSettings( capabilities );\n\t}\n\n\trender() {\n\t\tconst { children, post, capabilities, settings, ...props } = this.props;\n\t\tconst editorSettings = this.getEditorSettings( settings, capabilities );\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<EditorProvider\n\t\t\t\t\tpost={ this.post }\n\t\t\t\t\tsettings={ editorSettings }\n\t\t\t\t\t{ ...props }\n\t\t\t\t>\n\t\t\t\t\t<SafeAreaProvider>{ children }</SafeAreaProvider>\n\t\t\t\t</EditorProvider>\n\t\t\t\t<EditorHelpTopics\n\t\t\t\t\tisVisible={ this.state.isHelpVisible }\n\t\t\t\t\tonClose={ () => this.setState( { isHelpVisible: false } ) }\n\t\t\t\t\tclose={ () => this.setState( { isHelpVisible: false } ) }\n\t\t\t\t\tshowSupport={ capabilities?.supportSection === true }\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst {\n\t\t\t__unstableIsEditorReady: isEditorReady,\n\t\t\tgetEditorBlocks,\n\t\t\tgetEditedPostAttribute,\n\t\t\tgetEditedPostContent,\n\t\t} = select( editorStore );\n\t\tconst { getEditorMode } = select( editPostStore );\n\n\t\tconst {\n\t\t\tgetBlockIndex,\n\t\t\tgetSelectedBlockClientId,\n\t\t\tgetGlobalBlockCount,\n\t\t\tgetSettings: getBlockEditorSettings,\n\t\t} = select( blockEditorStore );\n\n\t\tconst settings = getBlockEditorSettings();\n\t\tconst defaultEditorColors = settings?.colors ?? [];\n\t\tconst defaultEditorGradients = settings?.gradients ?? [];\n\n\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\treturn {\n\t\t\tmode: getEditorMode(),\n\t\t\tisReady: isEditorReady(),\n\t\t\tblocks: getEditorBlocks(),\n\t\t\ttitle: getEditedPostAttribute( 'title' ),\n\t\t\tgetEditedPostContent,\n\t\t\tdefaultEditorColors,\n\t\t\tdefaultEditorGradients,\n\t\t\tselectedBlockIndex: getBlockIndex( selectedBlockClientId ),\n\t\t\tblockCount: getGlobalBlockCount(),\n\t\t\tparagraphCount: getGlobalBlockCount( 'core/paragraph' ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { editPost, resetEditorBlocks } = dispatch( editorStore );\n\t\tconst {\n\t\t\tupdateSettings,\n\t\t\tclearSelectedBlock,\n\t\t\tinsertBlock,\n\t\t\treplaceBlock,\n\t\t} = dispatch( blockEditorStore );\n\t\tconst { switchEditorMode } = dispatch( editPostStore );\n\t\tconst { addEntities, receiveEntityRecords } = dispatch( coreStore );\n\t\tconst { createSuccessNotice } = dispatch( noticesStore );\n\n\t\treturn {\n\t\t\tupdateSettings,\n\t\t\taddEntities,\n\t\t\tclearSelectedBlock,\n\t\t\tinsertBlock,\n\t\t\tcreateSuccessNotice,\n\t\t\teditTitle( title ) {\n\t\t\t\teditPost( { title } );\n\t\t\t},\n\t\t\treceiveEntityRecords,\n\t\t\tresetEditorBlocksWithoutUndoLevel( blocks ) {\n\t\t\t\tresetEditorBlocks( blocks, {\n\t\t\t\t\t__unstableShouldCreateUndoLevel: false,\n\t\t\t\t} );\n\t\t\t},\n\t\t\tswitchMode( mode ) {\n\t\t\t\tswitchEditorMode( mode );\n\t\t\t},\n\t\t\treplaceBlock,\n\t\t};\n\t} ),\n] )( NativeEditorProvider );\n"]}