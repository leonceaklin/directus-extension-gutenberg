{"version":3,"sources":["@wordpress/widgets/src/blocks/legacy-widget/edit/form.js"],"names":["classnames","useRef","useEffect","useDispatch","store","noticesStore","__","sprintf","Popover","useViewportMatch","Control","Form","title","isVisible","id","idBase","instance","isWide","onChangeInstance","onChangeHasPreview","ref","isMediumLargeViewport","outgoingInstances","Set","incomingInstances","createNotice","current","has","delete","control","nextInstance","add","onError","error","window","console","appendChild","element","destroy"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n/**\n * WordPress dependencies\n */\nimport { useRef, useEffect } from '@wordpress/element';\nimport { useDispatch } from '@wordpress/data';\nimport { store as noticesStore } from '@wordpress/notices';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Popover } from '@wordpress/components';\nimport { useViewportMatch } from '@wordpress/compose';\n/**\n * Internal dependencies\n */\nimport Control from './control';\n\nexport default function Form( {\n\ttitle,\n\tisVisible,\n\tid,\n\tidBase,\n\tinstance,\n\tisWide,\n\tonChangeInstance,\n\tonChangeHasPreview,\n} ) {\n\tconst ref = useRef();\n\n\tconst isMediumLargeViewport = useViewportMatch( 'small' );\n\n\t// We only want to remount the control when the instance changes\n\t// *externally*. For example, if the user performs an undo. To do this, we\n\t// keep track of changes made to instance by the control itself and then\n\t// ignore those.\n\tconst outgoingInstances = useRef( new Set() );\n\tconst incomingInstances = useRef( new Set() );\n\n\tconst { createNotice } = useDispatch( noticesStore );\n\n\tuseEffect( () => {\n\t\tif ( incomingInstances.current.has( instance ) ) {\n\t\t\tincomingInstances.current.delete( instance );\n\t\t\treturn;\n\t\t}\n\n\t\tconst control = new Control( {\n\t\t\tid,\n\t\t\tidBase,\n\t\t\tinstance,\n\t\t\tonChangeInstance( nextInstance ) {\n\t\t\t\toutgoingInstances.current.add( instance );\n\t\t\t\tincomingInstances.current.add( nextInstance );\n\t\t\t\tonChangeInstance( nextInstance );\n\t\t\t},\n\t\t\tonChangeHasPreview,\n\t\t\tonError( error ) {\n\t\t\t\twindow.console.error( error );\n\t\t\t\tcreateNotice(\n\t\t\t\t\t'error',\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t/* translators: %s: the name of the affected block. */\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'The \"%s\" block was affected by errors and may not function properly. Check the developer tools for more details.'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tidBase || id\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t},\n\t\t} );\n\n\t\tref.current.appendChild( control.element );\n\n\t\treturn () => {\n\t\t\tif ( outgoingInstances.current.has( instance ) ) {\n\t\t\t\toutgoingInstances.current.delete( instance );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcontrol.destroy();\n\t\t};\n\t}, [\n\t\tid,\n\t\tidBase,\n\t\tinstance,\n\t\tonChangeInstance,\n\t\tonChangeHasPreview,\n\t\tisMediumLargeViewport,\n\t] );\n\n\tif ( isWide && isMediumLargeViewport ) {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={ classnames( {\n\t\t\t\t\t'wp-block-legacy-widget__container': isVisible,\n\t\t\t\t} ) }\n\t\t\t>\n\t\t\t\t{ isVisible && (\n\t\t\t\t\t<h3 className=\"wp-block-legacy-widget__edit-form-title\">\n\t\t\t\t\t\t{ title }\n\t\t\t\t\t</h3>\n\t\t\t\t) }\n\t\t\t\t<Popover\n\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\tplacement=\"right\"\n\t\t\t\t\toffset={ 32 }\n\t\t\t\t\tresize={ false }\n\t\t\t\t\tflip={ false }\n\t\t\t\t\tshift\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\tclassName=\"wp-block-legacy-widget__edit-form\"\n\t\t\t\t\t\thidden={ ! isVisible }\n\t\t\t\t\t></div>\n\t\t\t\t</Popover>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tref={ ref }\n\t\t\tclassName=\"wp-block-legacy-widget__edit-form\"\n\t\t\thidden={ ! isVisible }\n\t\t>\n\t\t\t<h3 className=\"wp-block-legacy-widget__edit-form-title\">\n\t\t\t\t{ title }\n\t\t\t</h3>\n\t\t</div>\n\t);\n}\n"]}