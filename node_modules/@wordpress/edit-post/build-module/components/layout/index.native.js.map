{"version":3,"sources":["@wordpress/edit-post/src/components/layout/index.native.js"],"names":["Platform","SafeAreaView","View","SafeArea","Component","withSelect","BottomSheetSettings","FloatingToolbar","store","blockEditorStore","compose","withPreferredColorScheme","HTMLTextInput","KeyboardAvoidingView","NoticeList","Tooltip","__unstableAutocompletionItemsSlot","AutocompletionItemsSlot","AutosaveMonitor","editorStore","sendNativeEditorDidLayout","styles","headerToolbarStyles","Header","VisualEditor","editPostStore","Layout","constructor","arguments","onSafeAreaInsetsUpdate","bind","onRootViewLayout","state","rootViewHeight","safeAreaInsets","top","bottom","right","left","getSafeAreaInsetsForRootView","then","componentDidMount","_isMounted","safeAreaSubscription","addEventListener","componentWillUnmount","remove","result","setState","event","setHeightState","height","nativeEvent","layout","renderHTML","globalStyles","props","renderVisual","isReady","setTitleRef","render","getStylesFromColorScheme","mode","isHtmlView","marginBottom","OS","containerStyles","container","containerDark","toolbarKeyboardAvoidingViewStyle","toolbarKeyboardAvoidingView","backgroundColor","editorStyles","background","backgroundDark","flex","flexBasis","select","__unstableIsEditorReady","isEditorReady","getEditorMode","getSettings","__experimentalGlobalStylesBaseStyles","color"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { Platform, SafeAreaView, View } from 'react-native';\nimport SafeArea from 'react-native-safe-area';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { withSelect } from '@wordpress/data';\nimport {\n\tBottomSheetSettings,\n\tFloatingToolbar,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport {\n\tHTMLTextInput,\n\tKeyboardAvoidingView,\n\tNoticeList,\n\tTooltip,\n\t__unstableAutocompletionItemsSlot as AutocompletionItemsSlot,\n} from '@wordpress/components';\nimport { AutosaveMonitor, store as editorStore } from '@wordpress/editor';\nimport { sendNativeEditorDidLayout } from '@wordpress/react-native-bridge';\n\n/**\n * Internal dependencies\n */\nimport styles from './style.scss';\nimport headerToolbarStyles from '../header/header-toolbar/style.scss';\nimport Header from '../header';\nimport VisualEditor from '../visual-editor';\nimport { store as editPostStore } from '../../store';\n\nclass Layout extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onSafeAreaInsetsUpdate = this.onSafeAreaInsetsUpdate.bind( this );\n\t\tthis.onRootViewLayout = this.onRootViewLayout.bind( this );\n\n\t\tthis.state = {\n\t\t\trootViewHeight: 0,\n\t\t\tsafeAreaInsets: { top: 0, bottom: 0, right: 0, left: 0 },\n\t\t};\n\n\t\tSafeArea.getSafeAreaInsetsForRootView().then(\n\t\t\tthis.onSafeAreaInsetsUpdate\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tthis._isMounted = true;\n\t\tthis.safeAreaSubscription = SafeArea.addEventListener(\n\t\t\t'safeAreaInsetsForRootViewDidChange',\n\t\t\tthis.onSafeAreaInsetsUpdate\n\t\t);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.safeAreaSubscription?.remove();\n\t\tthis._isMounted = false;\n\t}\n\n\tonSafeAreaInsetsUpdate( result ) {\n\t\tconst { safeAreaInsets } = result;\n\t\tif ( this._isMounted ) {\n\t\t\tthis.setState( { safeAreaInsets } );\n\t\t}\n\t}\n\n\tonRootViewLayout( event ) {\n\t\tif ( this._isMounted ) {\n\t\t\tthis.setHeightState( event );\n\t\t}\n\t}\n\n\tsetHeightState( event ) {\n\t\tconst { height } = event.nativeEvent.layout;\n\t\tif ( height !== this.state.rootViewHeight ) {\n\t\t\tthis.setState(\n\t\t\t\t{ rootViewHeight: height },\n\t\t\t\tsendNativeEditorDidLayout\n\t\t\t);\n\t\t}\n\t}\n\n\trenderHTML() {\n\t\tconst { globalStyles } = this.props;\n\t\treturn (\n\t\t\t<HTMLTextInput\n\t\t\t\tparentHeight={ this.state.rootViewHeight }\n\t\t\t\tstyle={ globalStyles }\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderVisual() {\n\t\tconst { isReady } = this.props;\n\n\t\tif ( ! isReady ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn <VisualEditor setTitleRef={ this.props.setTitleRef } />;\n\t}\n\n\trender() {\n\t\tconst { getStylesFromColorScheme, mode, globalStyles } = this.props;\n\n\t\tconst isHtmlView = mode === 'text';\n\n\t\t// Add a margin view at the bottom for the header.\n\t\tconst marginBottom =\n\t\t\tPlatform.OS === 'android' && ! isHtmlView\n\t\t\t\t? headerToolbarStyles[ 'header-toolbar__container' ].height\n\t\t\t\t: 0;\n\n\t\tconst containerStyles = getStylesFromColorScheme(\n\t\t\tstyles.container,\n\t\t\tstyles.containerDark\n\t\t);\n\n\t\tconst toolbarKeyboardAvoidingViewStyle = {\n\t\t\t...styles.toolbarKeyboardAvoidingView,\n\t\t\tleft: this.state.safeAreaInsets.left,\n\t\t\tright: this.state.safeAreaInsets.right,\n\t\t\tbottom: this.state.safeAreaInsets.bottom,\n\t\t\tbackgroundColor: containerStyles.backgroundColor,\n\t\t};\n\n\t\tconst editorStyles = [\n\t\t\tgetStylesFromColorScheme(\n\t\t\t\tstyles.background,\n\t\t\t\tstyles.backgroundDark\n\t\t\t),\n\t\t\tglobalStyles?.background && {\n\t\t\t\tbackgroundColor: globalStyles.background,\n\t\t\t},\n\t\t];\n\n\t\treturn (\n\t\t\t<Tooltip.Slot>\n\t\t\t\t<SafeAreaView\n\t\t\t\t\tstyle={ containerStyles }\n\t\t\t\t\tonLayout={ this.onRootViewLayout }\n\t\t\t\t>\n\t\t\t\t\t<AutosaveMonitor disableIntervalChecks />\n\t\t\t\t\t<View style={ editorStyles }>\n\t\t\t\t\t\t{ isHtmlView ? this.renderHTML() : this.renderVisual() }\n\t\t\t\t\t\t{ ! isHtmlView && Platform.OS === 'android' && (\n\t\t\t\t\t\t\t<FloatingToolbar />\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t<NoticeList />\n\t\t\t\t\t</View>\n\t\t\t\t\t<View\n\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\tflex: 0,\n\t\t\t\t\t\t\tflexBasis: marginBottom,\n\t\t\t\t\t\t\theight: marginBottom,\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t\t{ ! isHtmlView && (\n\t\t\t\t\t\t<KeyboardAvoidingView\n\t\t\t\t\t\t\tparentHeight={ this.state.rootViewHeight }\n\t\t\t\t\t\t\tstyle={ toolbarKeyboardAvoidingViewStyle }\n\t\t\t\t\t\t\twithAnimatedHeight\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ Platform.OS === 'ios' && (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<AutocompletionItemsSlot />\n\t\t\t\t\t\t\t\t\t<FloatingToolbar />\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t<Header />\n\t\t\t\t\t\t\t<BottomSheetSettings />\n\t\t\t\t\t\t</KeyboardAvoidingView>\n\t\t\t\t\t) }\n\t\t\t\t\t{ Platform.OS === 'android' && <AutocompletionItemsSlot /> }\n\t\t\t\t</SafeAreaView>\n\t\t\t</Tooltip.Slot>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst { __unstableIsEditorReady: isEditorReady } =\n\t\t\tselect( editorStore );\n\t\tconst { getEditorMode } = select( editPostStore );\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\tconst globalStyles =\n\t\t\tgetSettings()?.__experimentalGlobalStylesBaseStyles?.color;\n\n\t\treturn {\n\t\t\tisReady: isEditorReady(),\n\t\t\tmode: getEditorMode(),\n\t\t\tglobalStyles,\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( Layout );\n"]}