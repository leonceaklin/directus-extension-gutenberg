{"version":3,"sources":["@wordpress/widgets/src/blocks/legacy-widget/edit/form.js"],"names":["Form","title","isVisible","id","idBase","instance","isWide","onChangeInstance","onChangeHasPreview","ref","isMediumLargeViewport","outgoingInstances","Set","incomingInstances","createNotice","noticesStore","current","has","delete","control","Control","nextInstance","add","onError","error","window","console","appendChild","element","destroy"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n/**\n * WordPress dependencies\n */\nimport { useRef, useEffect } from '@wordpress/element';\nimport { useDispatch } from '@wordpress/data';\nimport { store as noticesStore } from '@wordpress/notices';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Popover } from '@wordpress/components';\nimport { useViewportMatch } from '@wordpress/compose';\n/**\n * Internal dependencies\n */\nimport Control from './control';\n\nexport default function Form( {\n\ttitle,\n\tisVisible,\n\tid,\n\tidBase,\n\tinstance,\n\tisWide,\n\tonChangeInstance,\n\tonChangeHasPreview,\n} ) {\n\tconst ref = useRef();\n\n\tconst isMediumLargeViewport = useViewportMatch( 'small' );\n\n\t// We only want to remount the control when the instance changes\n\t// *externally*. For example, if the user performs an undo. To do this, we\n\t// keep track of changes made to instance by the control itself and then\n\t// ignore those.\n\tconst outgoingInstances = useRef( new Set() );\n\tconst incomingInstances = useRef( new Set() );\n\n\tconst { createNotice } = useDispatch( noticesStore );\n\n\tuseEffect( () => {\n\t\tif ( incomingInstances.current.has( instance ) ) {\n\t\t\tincomingInstances.current.delete( instance );\n\t\t\treturn;\n\t\t}\n\n\t\tconst control = new Control( {\n\t\t\tid,\n\t\t\tidBase,\n\t\t\tinstance,\n\t\t\tonChangeInstance( nextInstance ) {\n\t\t\t\toutgoingInstances.current.add( instance );\n\t\t\t\tincomingInstances.current.add( nextInstance );\n\t\t\t\tonChangeInstance( nextInstance );\n\t\t\t},\n\t\t\tonChangeHasPreview,\n\t\t\tonError( error ) {\n\t\t\t\twindow.console.error( error );\n\t\t\t\tcreateNotice(\n\t\t\t\t\t'error',\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t/* translators: %s: the name of the affected block. */\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'The \"%s\" block was affected by errors and may not function properly. Check the developer tools for more details.'\n\t\t\t\t\t\t),\n\t\t\t\t\t\tidBase || id\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t},\n\t\t} );\n\n\t\tref.current.appendChild( control.element );\n\n\t\treturn () => {\n\t\t\tif ( outgoingInstances.current.has( instance ) ) {\n\t\t\t\toutgoingInstances.current.delete( instance );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcontrol.destroy();\n\t\t};\n\t}, [\n\t\tid,\n\t\tidBase,\n\t\tinstance,\n\t\tonChangeInstance,\n\t\tonChangeHasPreview,\n\t\tisMediumLargeViewport,\n\t] );\n\n\tif ( isWide && isMediumLargeViewport ) {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={ classnames( {\n\t\t\t\t\t'wp-block-legacy-widget__container': isVisible,\n\t\t\t\t} ) }\n\t\t\t>\n\t\t\t\t{ isVisible && (\n\t\t\t\t\t<h3 className=\"wp-block-legacy-widget__edit-form-title\">\n\t\t\t\t\t\t{ title }\n\t\t\t\t\t</h3>\n\t\t\t\t) }\n\t\t\t\t<Popover\n\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\tplacement=\"right\"\n\t\t\t\t\toffset={ 32 }\n\t\t\t\t\tresize={ false }\n\t\t\t\t\tflip={ false }\n\t\t\t\t\tshift\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref={ ref }\n\t\t\t\t\t\tclassName=\"wp-block-legacy-widget__edit-form\"\n\t\t\t\t\t\thidden={ ! isVisible }\n\t\t\t\t\t></div>\n\t\t\t\t</Popover>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tref={ ref }\n\t\t\tclassName=\"wp-block-legacy-widget__edit-form\"\n\t\t\thidden={ ! isVisible }\n\t\t>\n\t\t\t<h3 className=\"wp-block-legacy-widget__edit-form-title\">\n\t\t\t\t{ title }\n\t\t\t</h3>\n\t\t</div>\n\t);\n}\n"]}